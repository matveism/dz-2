<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>QuizBux - Earn Real Money</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>
  <style>
    :root {
      --bg: #0f0f1e;
      --card: #1a1a2e;
      --primary: #667eea;
      --accent: #764ba2;
      --text: #e0e0ff;
      --text2: #a0a0cc;
      --success: #4ade80;
      --danger: #f87171;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:'Inter',sans-serif; background:var(--bg); color:var(--text); min-height:100vh; display:flex; justify-content:center; align-items:center; padding:20px; }
    .container { width:100%; max-width:420px; background:var(--card); border-radius:20px; overflow:hidden; box-shadow:0 20px 40px rgba(0,0,0,0.5); }
    .header { background:linear-gradient(135deg,var(--primary),var(--accent)); padding:25px; text-align:center; color:white; }
    .header img { height:45px; }
    .content { padding:30px; }
    input, textarea, select, button {
      width:100%; padding:15px; margin:10px 0; border-radius:12px; border:none; font-size:16px;
    }
    input, select, textarea { background:#16213e; color:white; }
    button { background:linear-gradient(135deg,var(--primary),var(--accent)); color:white; font-weight:bold; cursor:pointer; transition:0.3s; }
    button:hover { transform:translateY(-3px); box-shadow:0 10px 20px rgba(102,126,234,0.4); }
    button:disabled { opacity:0.5; cursor:not-allowed; }
    .section { display:none; }
    .active { display:block; }
    .text-center { text-align:center; }
    .mb-20 { margin-bottom:20px; }
    .link { color:var(--primary); cursor:pointer; text-decoration:underline; }
    .offerwall-grid { display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-top:20px; }
    .offer-btn { padding:20px; background:#16213e; border-radius:12px; text-align:center; color:white; }
    .modal { position:fixed; inset:0; background:rgba(0,0,0,0.8); display:none; align-items:center; justify-content:center; }
    .modal.active { display:flex; }
    .modal-content { background:var(--card); padding:30px; border-radius:20px; width:90%; max-width:400px; text-align:center; }
  </style>
</head>
<body>

<div class="container">
  <div class="header">
    <img src="https://i.postimg.cc/8Cs0zjMq/Screenshot-2025-11-13-at-7-09-50-PM-removebg-preview.png" alt="QuizBux">
    <h1>QuizBux</h1>
  </div>

  <div class="content">

    <!-- LOGIN -->
    <div id="loginSection" class="section active">
      <h2 class="text-center mb-20">Welcome Back</h2>
      <input type="text" id="loginUser" placeholder="Username" />
      <input type="password" id="loginPass" placeholder="Password" />
      <button onclick="login()">Login</button>
      <p class="text-center mb-20"><span class="link" onclick="showSection('signupSection')">Create Account</span></p>
    </div>

    <!-- SIGNUP -->
    <div id="signupSection" class="section">
      <h2 class="text-center mb-20">Create Account</h2>
      <input type="text" id="regUser" placeholder="Username" />
      <input type="email" id="regEmail" placeholder="Email" />
      <input type="password" id="regPass" placeholder="Password (min 6 chars)" />
      <button onclick="signup()">Sign Up</button>
      <p class="text-center"><span class="link" onclick="showSection('loginSection')">Back to Login</span></p>
    </div>

    <!-- VERIFY EMAIL -->
    <div id="verifySection" class="section">
      <h2 class="text-center mb-20">Verify Email</h2>
      <p>We sent a 6-digit code to your email</p>
      <input type="text" id="verifyCode" placeholder="Enter code" maxlength="6"/>
      <button onclick="verifyEmail()">Verify</button>
      <p class="text-center"><span class="link" onclick="resendCode()">Resend Code</span></p>
    </div>

    <!-- DASHBOARD -->
    <div id="dashboard" class="section">
      <h2>Hello, <span id="dashUser</span>!</h2>
      <div style="background:#16213e;padding:15px;border-radius:12px;margin:20px 0;">
        <div style="display:flex; justify-content:space-between;">
          <div>Points: <b id="dashPoints">0</b></div>
          <div>USD: <b id="dashUSD">$0.00</b></div>
        </div>
      </div>

      <button onclick="showSection('workSection')">Submit Work</button>
      <button onclick="showSection('cashoutSection')">Cashout</button>
      <button onclick="showSection('offerwallsSection')">Offerwalls</button>
      <button onclick="logout()">Logout</button>
    </div>

    <!-- SUBMIT WORK -->
    <div id="workSection" class="section">
      <h2>Submit Work</h2>
      <textarea id="workText" placeholder="Write your submission here..." style="height:150px;resize:vertical;"></textarea>
      <button onclick="submitWork()">Submit</button>
      <p class="text-center"><span class="link" onclick="showSection('dashboard')">← Back</span></p>
    </div>

    <!-- CASHOUT -->
    <div id="cashoutSection" class="section">
      <h2>Request Cashout</h2>
      <select id="rewardSelect">
        <option value="">Select Reward</option>
        <option value="paypal_5">PayPal $5.00</option>
        <option value="paypal_10">PayPal $10.00</option>
        <option value="amazon_1">Amazon £1 (~$1.39)</option>
      </select>
      <div id="cashoutInfo" style="margin:15px 0; padding:15px; background:#16213e; border-radius:12px; display:none;">
        <b>You will receive: <span id="rewardName"></span></b><br>
        Need: <span id="needUSD"></span> USD balance
      </div>
      <button onclick="requestCashout()" id="cashoutBtn" disabled>Request Cashout</button>
      <p class="text-center"><span class="link" onclick="showSection('dashboard')">← Back</span></p>
    </div>

    <!-- OFFERWALLS -->
    <div id="offerwallsSection" class="section">
      <h2>Earn More</h2>
      <div class="offerwall-grid" id="offerwallsList"></div>
      <p class="text-center"><span class="link" onclick="showSection('dashboard')">← Back</span></p>
    </div>

  </div>
</div>

<!-- MODALS -->
<div id="modal" class="modal">
  <div class="modal-content">
    <h3 id="modalTitle">Success</h3>
    <p id="modalMsg">Done!</p>
    <button onclick="closeModal()" style="margin-top:20px;">OK</button>
  </div>
</div>

<script>
  // YOUR REAL WEB APP URL HERE (CHANGE THIS!)
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwTelvEYce1YEgw8-RDKth6xa_VJGRu2YOTxRMcgTGLuL6IXgO7tFG3xllYW4czAdbEEg/exec";

  let currentUser = null;
  let verifyData = null;

  function $(id) { return document.getElementById(id); }

  function showSection(id) {
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    $(id).classList.add('active');
  }

  function modal(title, msg) {
    $('modalTitle').textContent = title;
    $('modalMsg').textContent = msg;
    $('modal').classList.add('active');
  }

  function closeModal() { $('modal').classList.remove('active'); }

  async function api(action, data = {}) {
    const fd = new FormData();
    fd.append('action', action);
    Object.keys(data).forEach(k => fd.append(k, data[k]));
    const r = await fetch(SCRIPT_URL, { method: "POST", body: fd });
    return await r.json();
  }

  // LOGIN
  async function login() {
    const u = $('loginUser').value.trim();
    const p = $('loginPass').value;
    if (!u || !p) return modal("Error", "Fill all fields");

    const res = await api('login', {username: u, password: p});
    if (res.status === "success") {
      currentUser = res.user;
      updateDash();
      showSection('dashboard');
    } else {
      modal("Login Failed", res.message);
    }
  }

  // SIGNUP
  async function signup() {
    const u = $('regUser').value.trim();
    const e = $('regEmail').value.trim();
    const p = $('regPass').value;
    if (!u || !e || !p) return modal("Error", "Fill all fields");
    if (p.length < 6) return modal("Error", "Password min 6 chars");

    const res = await api('signup', {username: u, email: e, password: p});
    if (res.status === "success") {
      verifyData = {username: u, email: e, password: p};
      modal("Check Email", res.message);
      showSection('verifySection');
    } else {
      modal("Signup Failed", res.message);
    }
  }

  // VERIFY EMAIL
  async function verifyEmail() {
    const code = $('verifyCode').value.trim();
    if (!code || code.length !== 6) return modal("Error", "Enter 6-digit code");

    const res = await api('verifyEmail', {...verifyData, code});
    if (res.status === "success") {
      modal("Success", "Account verified! You can now login.");
      showSection('loginSection');
      verifyData = null;
    } else {
      modal("Error", res.message);
    }
  }

  async function resendCode() {
    if (!verifyData) return;
    const res = await api('resendCode', {username: verifyData.username, email: verifyData.email});
    modal(res.status === "success" ? "Sent" : "Error", res.message);
  }

  // DASHBOARD UPDATE
  function updateDash() {
    $('dashUser').textContent = currentUser.username;
    $('dashPoints').textContent = currentUser.balance;
    $('dashUSD').textContent = "$" + Number(currentUser.balanceUSD).toFixed(2);
  }

  // SUBMIT WORK
  async function submitWork() {
    const text = $('workText').value.trim();
    if (!text) return modal("Error", "Write something");

    const res = await api('submitWork', {username: currentUser.username, submission: text});
    modal(res.status === "success" ? "Success" : "Error", res.message);
    if (res.status === "success") {
      $('workText').value = '';
      const u = await api('getUserData', {username: currentUser.username});
      if (u.status === "success") currentUser = u.user;
      updateDash();
    }
  }

  // CASHOUT
  async function requestCashout() {
    const sel = $('rewardSelect');
    const id = sel.value;
    if (!id) return;

    const name = sel.selectedOptions[0].text;
    const amount = parseFloat(id.split('_')[1]) || 1.39;

    const res = await api('submitCashout', {
      username: currentUser.username,
      reward: name,
      amount: amount
    });

    modal(res.status === "success" ? "Success" : "Error", res.message);
    if (res.status === "success") {
      const u = await api('getUserData', {username: currentUser.username});
      if (u.status === "success") currentUser = u.user;
      updateDash();
      sel.value = "";
      $('cashoutInfo').style.display = 'none';
      $('cashoutBtn').disabled = true;
    }
  }

  $('rewardSelect').addEventListener('change', () => {
    const sel = $('rewardSelect');
    if (!sel.value) {
      $('cashoutInfo').style.display = 'none';
      $('cashoutBtn').disabled = true;
      return;
    }
    const name = sel.selectedOptions[0].text;
    const amount = sel.value.includes('amazon') ? 1.39 : parseFloat(sel.value.split('_')[1]);
    $('rewardName').textContent = name;
    $('needUSD').textContent = "$" + amount.toFixed(2);
    $('cashoutInfo').style.display = 'block';
    $('cashoutBtn').disabled = currentUser.balanceUSD < amount;
  });

  // OFFERWALLS
  async function loadOfferwalls() {
    const res = await api('getOfferwalls', {username: currentUser.username});
    if (res.status !== "success") return;

    const list = $('offerwallsList');
    list.innerHTML = "";
    res.offerwalls.forEach(w => {
      const div = document.createElement('div');
      div.className = "offer-btn";
      div.innerHTML = `<i class="fas fa-gift" style="font-size:24px;margin-bottom:8px;"></i><br>${w.name}`;
      div.onclick = () => {
        window.open(w.url, '_blank');
      };
      list.appendChild(div);
    });
  }

  // AUTO LOAD OFFERWALLS WHEN OPENING SECTION
  const orig = showSection;
  showSection = function(id) {
    orig(id);
    if (id === 'offerwallsSection' && currentUser) loadOfferwalls();
  };

  // LOGOUT
  function logout() {
    currentUser = null;
    showSection('loginSection');
    modal("Logged Out", "See you soon!");
  }

  // TEST ACCOUNT AUTO-FILL (remove in production)
  if (location.hostname === "127.0.0.1" || location.hostname === "localhost") {
    $('loginUser').value = "test";
    $('loginPass').value = "123";
  }
</script>
</body>
</html>
