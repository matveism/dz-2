<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="description" content="Earn crypto, PayPal funds, and gift cards by completing offers and surveys" />
    <meta name="theme-color" content="#0a0a12" />
    <meta name="clckd" content="45663763f89113271aedcb23f063dab2" />
    <title>Bux IQ - Premium Rewards Platform</title>
    <link rel="icon" type="image/png" href="https://i.imgur.com/wppiqAy.png" />
    <link rel="apple-touch-icon" href="https://i.imgur.com/wppiqAy.png" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="Bux iQ" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://v1.mychips.io/SDK/latest/my-chips-sdk.bundle.js"></script>
    
    <style>
        /* Modern Windows Mobile 6.5 Style */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Segoe UI", "Segoe WP", Tahoma, Arial, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #5d7ca6 0%, #3a5a8c 100%);
            color: #000;
            font-size: 14px;
            line-height: 1.4;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* Header */
        .wm-header {
            background: linear-gradient(135deg, #2c5aa0 0%, #1e3a6b 50%, #0f1f3a 100%);
            color: white;
            height: 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 12px;
            border-bottom: 1px solid #0f1f3a;
            font-weight: bold;
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .wm-header .start {
            font-size: 18px;
            display: flex;
            align-items: center;
        }
        
        .wm-header .title {
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            flex-grow: 1;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }
        
        .wm-header .time {
            font-size: 14px;
        }
        
        /* Main Content */
        .wm-content {
            margin-top: 40px;
            margin-bottom: 60px;
            padding: 12px;
            min-height: calc(100vh - 100px);
        }
        
        /* Windows Mobile Tabs */
        .wm-tabs {
            display: flex;
            background: linear-gradient(135deg, #4a6a9c 0%, #2c4163 100%);
            border-bottom: 1px solid #2c4163;
            overflow-x: auto;
            border-radius: 6px 6px 0 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .wm-tab {
            padding: 10px 16px;
            background: linear-gradient(135deg, #6b8cc0 0%, #4a6a9c 100%);
            border: 1px solid #4a6a9c;
            border-bottom: none;
            border-radius: 6px 6px 0 0;
            margin-right: 2px;
            color: white;
            font-weight: bold;
            white-space: nowrap;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .wm-tab:hover {
            background: linear-gradient(135deg, #7b9cd0 0%, #5a7aac 100%);
        }
        
        .wm-tab.active {
            background: linear-gradient(135deg, #8faad6 0%, #6b8cc0 100%);
            color: #000;
            box-shadow: inset 0 2px 4px rgba(255, 255, 255, 0.5);
        }
        
        /* Content Sections */
        .wm-section {
            background: linear-gradient(135deg, #e8eef7 0%, #d4dff2 100%);
            border: 1px solid #8faad6;
            border-radius: 6px;
            padding: 16px;
            margin-top: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1), inset 1px 1px 0 #fff, inset -1px -1px 0 #a3b3ce;
        }
        
        .wm-section h2 {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 12px;
            color: #1e3a6b;
            border-bottom: 2px solid #8faad6;
            padding-bottom: 6px;
            text-shadow: 0 1px 1px rgba(255, 255, 255, 0.8);
        }
        
        /* Windows Mobile Buttons */
        .wm-button {
            background: linear-gradient(135deg, #f0f0f0 0%, #d4d4d4 50%, #b8b8b8 100%);
            border: 1px solid #808080;
            border-radius: 4px;
            padding: 8px 16px;
            font-size: 14px;
            color: #000;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            margin: 6px 0;
            display: inline-block;
            text-align: center;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        
        .wm-button:hover {
            background: linear-gradient(135deg, #f8f8f8 0%, #e0e0e0 50%, #c8c8c8 100%);
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.3);
        }
        
        .wm-button:active {
            background: linear-gradient(135deg, #d4d4d4 0%, #b8b8b8 50%, #a0a0a0 100%);
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .wm-button.primary {
            background: linear-gradient(135deg, #4a6a9c 0%, #2c4163 50%, #1e3a6b 100%);
            color: white;
            border-color: #1e3a6b;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            text-shadow: 0 1px 1px rgba(0, 0, 0, 0.5);
        }
        
        .wm-button.primary:hover {
            background: linear-gradient(135deg, #5a7aac 0%, #3c5173 50%, #2e4a7b 100%);
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.4);
        }
        
        .wm-button.primary:active {
            background: linear-gradient(135deg, #3a5a8c 0%, #1c3153 50%, #0e2a5b 100%);
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.4);
        }
        
        /* Google Login Button */
        .google-login-btn {
            background: #4285f4;
            color: white;
            border: 1px solid #4285f4;
            border-radius: 4px;
            padding: 10px 16px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            margin: 10px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            font-weight: 600;
        }
        
        .google-login-btn i {
            margin-right: 8px;
            font-size: 16px;
        }
        
        .google-login-btn:hover {
            background: #3367d6;
            box-shadow: 0 3px 6px rgba(0,0,0,0.3);
        }
        
        .divider {
            text-align: center;
            margin: 16px 0;
            color: #4a6a9c;
            position: relative;
        }
        
        .divider::before {
            content: "";
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: #8faad6;
            z-index: 1;
        }
        
        .divider span {
            background: #d4dff2;
            padding: 0 12px;
            position: relative;
            z-index: 2;
        }
        
        /* Input Fields */
        .wm-input {
            background: white;
            border: 1px solid #808080;
            border-radius: 4px;
            padding: 8px 12px;
            font-size: 14px;
            width: 100%;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
            margin: 6px 0;
            transition: all 0.3s ease;
        }
        
        .wm-input:focus {
            border-color: #4a6a9c;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.2), 0 0 5px rgba(74, 106, 156, 0.5);
            outline: none;
        }
        
        /* List Items */
        .wm-list {
            background: white;
            border: 1px solid #8faad6;
            border-radius: 6px;
            overflow: hidden;
            margin: 10px 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .wm-list-item {
            padding: 10px 14px;
            border-bottom: 1px solid #d4dff2;
            display: flex;
            align-items: center;
            transition: background 0.3s ease;
        }
        
        .wm-list-item:hover {
            background: #f0f5ff;
        }
        
        .wm-list-item:last-child {
            border-bottom: none;
        }
        
        .wm-list-item .icon {
            width: 28px;
            height: 28px;
            margin-right: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #4a6a9c 0%, #2c4163 100%);
            color: white;
            border-radius: 4px;
            font-size: 14px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }
        
        /* Footer Navigation */
        .wm-footer {
            background: linear-gradient(135deg, #2c5aa0 0%, #1e3a6b 50%, #0f1f3a 100%);
            height: 60px;
            position: fixed;
            bottom: 0;
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 12px;
            border-top: 1px solid #0f1f3a;
            z-index: 1000;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .wm-footer-button {
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            width: 64px;
            height: 48px;
            text-align: center;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.3s ease;
        }
        
        .wm-footer-button i {
            font-size: 18px;
            margin-bottom: 4px;
        }
        
        .wm-footer-button:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .wm-footer-button.active {
            background: rgba(255, 255, 255, 0.2);
            box-shadow: inset 0 2px 4px rgba(255, 255, 255, 0.2);
        }
        
        /* Status Bar */
        .wm-status-bar {
            background: linear-gradient(135deg, #4a6a9c 0%, #2c4163 100%);
            color: white;
            padding: 8px 12px;
            font-size: 12px;
            display: flex;
            justify-content: space-between;
            border-radius: 4px;
            margin-top: 10px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }
        
        /* Hidden sections */
        .hidden {
            display: none !important;
        }
        
        /* Logs Section */
        .wm-logs {
            background: white;
            border: 1px solid #8faad6;
            border-radius: 6px;
            height: 140px;
            overflow-y: auto;
            padding: 10px;
            font-family: "Courier New", monospace;
            font-size: 12px;
            margin: 10px 0;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        /* Login Form */
        .wm-login-form {
            background: white;
            border: 1px solid #8faad6;
            border-radius: 6px;
            padding: 16px;
            margin: 10px 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .wm-login-form label {
            display: block;
            margin-bottom: 6px;
            font-weight: bold;
            color: #1e3a6b;
        }
        
        /* CAPTCHA */
        .wm-captcha {
            background: #e8eef7;
            border: 1px solid #8faad6;
            border-radius: 4px;
            padding: 10px;
            text-align: center;
            font-family: "Courier New", monospace;
            font-size: 20px;
            font-weight: bold;
            letter-spacing: 3px;
            margin: 10px 0;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        /* Offer Wall Grid */
        .wm-offer-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 10px 0;
        }
        
        .wm-offer-item {
            background: white;
            border: 1px solid #8faad6;
            border-radius: 6px;
            padding: 12px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .wm-offer-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        
        .wm-offer-item img {
            max-width: 100%;
            height: 50px;
            object-fit: contain;
            margin-bottom: 10px;
        }
        
        /* Leaderboard */
        .wm-leaderboard {
            background: white;
            border: 1px solid #8faad6;
            border-radius: 6px;
            overflow: hidden;
            margin: 10px 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .wm-leaderboard table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .wm-leaderboard th {
            background: linear-gradient(135deg, #4a6a9c 0%, #2c4163 100%);
            color: white;
            padding: 8px 10px;
            text-align: left;
            font-weight: bold;
            border-right: 1px solid #2c4163;
        }
        
        .wm-leaderboard th:last-child {
            border-right: none;
        }
        
        .wm-leaderboard td {
            padding: 8px 10px;
            border-bottom: 1px solid #d4dff2;
        }
        
        .wm-leaderboard tr:last-child td {
            border-bottom: none;
        }
        
        .wm-leaderboard tr:hover {
            background: #f0f5ff;
        }
        
        /* FAQ Items */
        .wm-faq-item {
            background: white;
            border: 1px solid #8faad6;
            border-radius: 6px;
            padding: 12px;
            margin: 10px 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .wm-faq-item h4 {
            color: #1e3a6b;
            margin-bottom: 6px;
            font-weight: bold;
        }
        
        /* Iframe Container */
        .wm-iframe-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            z-index: 2000;
            display: none;
        }
        
        .wm-iframe-header {
            background: linear-gradient(135deg, #2c5aa0 0%, #1e3a6b 100%);
            color: white;
            height: 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 12px;
            border-bottom: 1px solid #0f1f3a;
        }
        
        .wm-iframe-content {
            height: calc(100% - 40px);
        }
        
        .wm-iframe-content iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        /* Notification Badge */
        .wm-notification-badge {
            background: #ff0000;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: absolute;
            top: -2px;
            right: -2px;
        }
        
        /* User Info */
        .wm-user-info {
            background: white;
            border: 1px solid #8faad6;
            border-radius: 6px;
            padding: 12px;
            margin: 10px 0;
            display: flex;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .wm-user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 6px;
            margin-right: 12px;
            border: 1px solid #8faad6;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }
        
        .wm-user-details {
            flex-grow: 1;
        }
        
        .wm-user-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }
        
        .wm-stat {
            text-align: center;
            flex: 1;
        }
        
        .wm-stat-value {
            font-weight: bold;
            font-size: 18px;
            color: #1e3a6b;
        }
        
        .wm-stat-label {
            font-size: 11px;
            color: #4a6a9c;
        }
        
        /* Bonus Section Styles */
        .bonus-code-section {
            background: linear-gradient(135deg, #e8eef7 0%, #d4dff2 100%);
            border: 1px solid #8faad6;
            border-radius: 6px;
            padding: 16px;
            margin-top: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1), inset 1px 1px 0 #fff, inset -1px -1px 0 #a3b3ce;
        }
        
        .info-box {
            background: #fff9e6;
            border: 1px solid #e6c200;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            display: flex;
            align-items: flex-start;
        }
        
        .info-box i {
            color: #e6c200;
            margin-right: 10px;
            margin-top: 2px;
        }
        
        .bonus-form {
            background: white;
            border: 1px solid #8faad6;
            border-radius: 6px;
            padding: 16px;
            margin: 10px 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .form-group {
            margin-bottom: 14px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: bold;
            color: #1e3a6b;
        }
        
        .form-row {
            display: flex;
            gap: 10px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        /* Game Styles */
        .game-container {
            background: white;
            border: 1px solid #8faad6;
            border-radius: 6px;
            padding: 16px;
            margin: 10px 0;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .game-title {
            color: #1e3a6b;
            margin-bottom: 12px;
            font-weight: bold;
        }
        
        .game-description {
            margin-bottom: 16px;
            color: #4a6a9c;
        }
        
        .bet-input-container {
            margin-bottom: 16px;
        }
        
        .bet-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #8faad6;
            border-radius: 4px;
            text-align: center;
            font-size: 16px;
            margin-bottom: 8px;
        }
        
        .bet-info {
            font-size: 12px;
            color: #4a6a9c;
        }
        
        .game-roller {
            width: 100%;
            height: 60px;
            background: linear-gradient(135deg, #4a6a9c 0%, #2c4163 100%);
            border-radius: 6px;
            margin: 16px 0;
            position: relative;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .roller-content {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 18px;
        }
        
        .game-result {
            margin: 16px 0;
            padding: 10px;
            border-radius: 4px;
            font-weight: bold;
            display: none;
        }
        
        .win {
            background: #d4ffd4;
            color: #006400;
            border: 1px solid #006400;
        }
        
        .lose {
            background: #ffd4d4;
            color: #8b0000;
            border: 1px solid #8b0000;
        }
        
        .cooldown-message {
            margin: 10px 0;
            padding: 8px;
            background: #fff9e6;
            border: 1px solid #e6c200;
            border-radius: 4px;
            color: #8b7500;
            display: none;
        }
        
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            display: none;
        }
        
        .modal-content {
            background: white;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        
        .modal-header {
            background: linear-gradient(135deg, #2c5aa0 0%, #1e3a6b 100%);
            color: white;
            padding: 16px;
            border-radius: 8px 8px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h2 {
            margin: 0;
            font-size: 18px;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
        }
        
        .modal-body {
            padding: 16px;
            max-height: 60vh;
            overflow-y: auto;
        }
        
        .modal-body h3 {
            color: #1e3a6b;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .modal-body p {
            margin-bottom: 12px;
            line-height: 1.5;
        }
        
        .modal-body ul {
            margin-left: 20px;
            margin-bottom: 12px;
        }
    </style>
</head>
<body>
    <!-- Windows Mobile Header -->
    <div class="wm-header">
        <div class="start">Start</div>
        <div class="title">Bux iQ</div>
        <div class="time" id="headerTime">12:00 PM</div>
    </div>
    
    <!-- Main Content -->
    <div class="wm-content">
        <!-- Tabs -->
        <div class="wm-tabs">
            <div class="wm-tab active" data-section="earn">Home</div>
            <div class="wm-tab" data-section="shop">Shop</div>
            <div class="wm-tab" data-section="leaders">Leaders</div>
            <div class="wm-tab" data-section="profile">Earn</div>
            <div class="wm-tab" data-section="bonus">Bonus</div>
            <div class="wm-tab" data-section="help">Help</div>
            <div class="wm-tab" data-section="privacy">Privacy</div>
            <div class="wm-tab" data-section="tos">TOS</div>
        </div>
        
        <!-- Status Bar -->
        <div class="wm-status-bar">
            <center><div>$1 . 00 => 1 pts</div></center>
            <div id="serverTime">Server Time: 00:00:00</div>
        </div>
        
        <!-- Home Section -->
        <div id="section-earn" class="wm-section">
            <h2>Welcome to Bux iQ</h2>
            
            <div class="wm-logs" id="logs">
                <div class="wm-list-item">
                    <div class="icon"><i class="fas fa-info-circle"></i></div>
                    <div>Your activity log will appear here</div>
                </div>
            </div>
            
            <div class="wm-user-info" id="userInfo">
                <img src="https://ui-avatars.com/api/?background=2c5aa0&color=fff&name=Guest&bold=true" class="wm-user-avatar" id="userAvatar" alt="User Avatar">
                <div class="wm-user-details">
                    <div id="userName">Guest User</div>
                    <div class="wm-user-stats">
                        <div class="wm-stat">
                            <div class="wm-stat-value" id="userBalance">$0.00</div>
                            <div class="wm-stat-label">Balance</div>
                        </div>
                        <div class="wm-stat">
                            <div class="wm-stat-value" id="userLevel">0</div>
                            <div class="wm-stat-label">Level</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="wm-button primary" style="width: 100%;" id="loginButton">Login to Earn</div>
            
            <h2>How It Works</h2>
            <div class="wm-list">
                <div class="wm-list-item">
                    <div class="icon"><i class="fas fa-tasks"></i></div>
                    <div>Complete Surveys</div>
                </div>
                <div class="wm-list-item">
                    <div class="icon"><i class="fas fa-star"></i></div>
                    <div>Earn Stars</div>
                </div>
                <div class="wm-list-item">
                    <div class="icon"><i class="fas fa-gift"></i></div>
                    <div>Redeem Rewards</div>
                </div>
            </div>
            
            <h2>Cashout Options</h2>
            <div class="wm-list">
                <div class="wm-list-item">
                    <div class="icon"><i class="fab fa-amazon"></i></div>
                    <div>Amazon UK Voucher</div>
                </div>
                <div class="wm-list-item">
                    <div class="icon"><i class="fab fa-bitcoin"></i></div>
                    <div>LTC Crypto</div>
                </div>
                <div class="wm-list-item">
                    <div class="icon"><i class="fas fa-plus"></i></div>
                    <div>More Coming Soon!</div>
                </div>
            </div>
        </div>
        
        <!-- Shop Section -->
        <div id="section-shop" class="wm-section hidden">
            <h2>Shop Rewards</h2>
            <div class="wm-offer-grid">
                <div class="wm-offer-item">
                    <img src="https://i.imgur.com/3CUrxKO.png" alt="BUXiQ Logo">
                    <div class="wm-button primary" id="openOfferWallbuxiq">Cashout</div>
                </div>
            </div>
        </div>
        
        <!-- Leaders Section -->
        <div id="section-leaders" class="wm-section hidden">
            <h2>Leaderboard</h2>
            <div class="wm-leaderboard">
                <table>
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Username</th>
                            <th>Earnings</th>
                            <th>Level</th>
                        </tr>
                    </thead>
                    <tbody id="leaderboardBody">
                        <tr>
                            <td>1</td>
                            <td>Loading...</td>
                            <td>$0.00</td>
                            <td>0</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Profile/Earn Section -->
        <div id="section-profile" class="wm-section hidden">
            <div id="login-container">
                <h2>Login</h2>
                
                <!-- Google Login Button -->
                <div id="g_id_onload"
                    data-client_id="387422659555-007kjhq0c41f2lq39e075ib5mtpf3q9o.apps.googleusercontent.com"
                    data-context="signin"
                    data-ux_mode="popup"
                    data-callback="handleGoogleCredentialResponse"
                    data-auto_prompt="false">
                </div>

                <div class="g_id_signin google-login-btn" 
                     data-type="standard" 
                     data-theme="filled_blue" 
                     data-text="signin_with" 
                     data-shape="rectangular" 
                     data-logo_alignment="left">
                </div>
                
                <div class="divider">
                    <span>OR</span>
                </div>
                
                <!-- Manual Login -->
                <div class="wm-login-form">
                    <label for="login-account">Account #</label>
                    <input type="text" id="login-account" class="wm-input" placeholder="Enter your account number">
                    
                    <label for="login-clientid">Client ID</label>
                    <input type="text" id="login-clientid" class="wm-input" placeholder="Enter your client ID">
                    
                    <label>CAPTCHA</label>
                    <div class="wm-captcha" id="captcha"></div>
                    <input type="text" id="captchaInput" class="wm-input" placeholder="Enter CAPTCHA">
                    
                    <div class="wm-button primary" style="width: 100%;" id="loginFormButton">Login</div>
                </div>
                <div id="error-msg" class="hidden" style="color: red; text-align: center; margin-top: 8px;"></div>
            </div>
            
            <div id="dashboard" class="hidden">
                <h2>Earning Portal</h2>
                <p style="margin-bottom: 12px; text-align: center;">Complete offers and surveys to earn rewards</p>
                
                <div class="wm-offer-grid" id="offerwall-grid">
                    <div class="wm-offer-item">
                        <img src="https://www.cpx-research.com/main/en/assets/img/logo.svg" alt="CPX Research Logo">
                        <div class="wm-button primary" id="openOfferWallCPX">Open OfferWall</div>
                    </div>
                    <div class="wm-offer-item">
                        <img src="https://affi-plat.s3.us-east-2.amazonaws.com/platforms/wannads-ogotipo-naranja.png" alt="Wannads Logo">
                        <div class="wm-button primary" id="openOfferWallwannads">Open OfferWall</div>
                    </div>
                    <div class="wm-offer-item">
                        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTmpR4eOpo8ckwPlqM2UXcwd-FJixOFTruEJQ&s" alt="Notik Logo">
                        <div class="wm-button primary" id="openOfferWallnotik">Open OfferWall</div>
                    </div>
                    <div class="wm-offer-item">
                        <img src="https://excentiv.com/images/app-logo.svg" alt="Excentiv Logo">
                        <div class="wm-button primary" id="openOfferWallexcentiv">Open OfferWall</div>
                    </div>
                    <div class="wm-offer-item">
                        <img src="https://i.imgur.com/wppiqAy.png" alt="Bux iQ Game">
                        <div class="wm-button primary" id="playGameButton">Play Game</div>
                    </div>
                </div>
                
                <div class="wm-button" style="width: 100%; margin-top: 12px;" id="logoutBtn">Logout</div>
            </div>
        </div>
        
        <!-- Bonus Section -->
        <div id="section-bonus" class="bonus-code-section hidden">
            <h2>Redeem Bonus Code</h2>
            
            <div class="info-box">
                <i class="fas fa-exclamation-triangle"></i>
                <div>WHO FIRST REDEEMED HIS/HER PTS! EACH BONUS CODE WILL BE MARKED AS UNUSED - FIRST COME FIRST SERVED!!!</div>
            </div>
            
            <form class="bonus-form" id="redeemForm">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" class="wm-input" required placeholder="Enter your username">
                </div>
                
                <div class="form-group">
                    <label for="bonusCode">Bonus Code</label>
                    <input type="text" id="bonusCode" class="wm-input" required placeholder="Enter bonus code">
                </div>
                
                <button type="button" class="wm-button primary" id="redeemBonusButton">Redeem Bonus Code</button>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="amountLocal">Amount (Local)</label>
                        <input type="text" id="amountLocal" class="wm-input" readonly placeholder="0">
                    </div>
                    
                    <div class="form-group">
                        <label for="amountUsd">Amount (USD)</label>
                        <input type="text" id="amountUsd" class="wm-input" readonly placeholder="$0.00">
                    </div>
                </div>
            </form>
        </div>
        
        <!-- Help Section -->
        <div id="section-help" class="wm-section hidden">
            <h2>Help & Support</h2>
            
            <div class="wm-faq-item">
                <h4>How do I earn points?</h4>
                <p>1. IF YOU DID NOT LOGGED IN YET LOGIN FIRST AND THEN EITHER CLICK LOGIN TO EARN IF YOU ARE IN THE HOME PAGE.</p>
                <p>2. CLICK EITHER TAB ABOVE, EITHER BELOW, BUTTON or TAB EARN.</p>
                <p>3. YOU ALL SEE OFFERWALLS AND YOU CLICK ON THEM DO OFFERS OR SURVEYS!</p>
            </div>
            
            <div class="wm-faq-item">
                <h4>How can I redeem rewards?</h4>
                <p>YOU MAY CLICK EITHER ABOVE, OR, BELOW TAB OR BUTTON "SHOP".</p>
            </div>
            
            <div class="wm-faq-item">
                <h4>HOW TO REDEEM BONUS CODE?</h4>
                <p>CLICK TAB OR BUTTON<strong> BONUS</strong> YOU MUST FILL OUT A FORM PUT YOUR ACCOUNT# AND ENTER BONUS CODE.</p>
            </div>
            
            <div class="wm-faq-item">
                <h4>Who do I contact for support?</h4>
                <p>Our ADMIN is available from 10 am - 5 pm PST. Click the button below to contact us.</p>
            </div>
            
            <div class="wm-button primary" style="width: 100%;" id="contact-support-btn">Contact Support</div>
        </div>
        
        <!-- Privacy Policy Section -->
        <div id="section-privacy" class="wm-section hidden">
            <h2>Privacy Policy</h2>
            
            <div class="wm-faq-item">
                <h4>Information We Collect</h4>
                <p>We collect information you provide directly to us, such as when you create an account, complete surveys, or contact us for support.</p>
            </div>
            
            <div class="wm-faq-item">
                <h4>How We Use Your Information</h4>
                <p>We use the information we collect to provide, maintain, and improve our services, process your transactions, and communicate with you.</p>
            </div>
            
            <div class="wm-faq-item">
                <h4>Information Sharing</h4>
                <p>We do not sell your personal information to third parties. We may share information with trusted partners who assist us in operating our platform.</p>
            </div>
            
            <div class="wm-faq-item">
                <h4>Data Security</h4>
                <p>We implement appropriate security measures to protect your personal information from unauthorized access and disclosure.</p>
            </div>
            
            <div class="wm-faq-item">
                <h4>Your Choices</h4>
                <p>You can access, update, or delete your personal information by contacting us. You may also opt out of promotional communications.</p>
            </div>
        </div>
        
        <!-- Terms of Service Section -->
        <div id="section-tos" class="wm-section hidden">
            <h2>Terms of Service</h2>
            
            <div class="wm-faq-item">
                <h4>Acceptance of Terms</h4>
                <p>By accessing or using Bux iQ, you agree to be bound by these Terms of Service and our Privacy Policy.</p>
            </div>
            
            <div class="wm-faq-item">
                <h4>Eligibility</h4>
                <p>You must be at least 18 years old to use our services. By using Bux iQ, you represent that you meet this requirement.</p>
            </div>
            
            <div class="wm-faq-item">
                <h4>User Accounts</h4>
                <p>You are responsible for maintaining the confidentiality of your account credentials and for all activities that occur under your account.</p>
            </div>
            
            <div class="wm-faq-item">
                <h4>Prohibited Activities</h4>
                <p>You agree not to engage in any fraudulent activities, use automated systems, or attempt to circumvent our security measures.</p>
            </div>
            
            <div class="wm-faq-item">
                <h4>Rewards and Payments</h4>
                <p>Rewards are subject to verification and may be revoked if fraud is detected. We reserve the right to modify or discontinue any reward program.</p>
            </div>
            
            <div class="wm-faq-item">
                <h4>Termination</h4>
                <p>We may suspend or terminate your account at any time for violations of these terms or for any other reason at our sole discretion.</p>
            </div>
        </div>
    </div>
    
    <!-- Footer Navigation -->
    <div class="wm-footer">
        <div class="wm-footer-button active" data-section="earn">
            <i class="fas fa-home"></i>
            <span>Home</span>
        </div>
        <div class="wm-footer-button" data-section="shop">
            <i class="fas fa-shopping-bag"></i>
            <span>Shop</span>
        </div>
        <div class="wm-footer-button" data-section="leaders">
            <i class="fas fa-trophy"></i>
            <span>Leaders</span>
        </div>
        <div class="wm-footer-button" data-section="profile">
            <i class="fas fa-money-bill-wave"></i>
            <span>Earn</span>
        </div>
        <div class="wm-footer-button" data-section="bonus">
            <i class="fas fa-star"></i>
            <span>BONUS</span>
        </div>
        <div class="wm-footer-button" data-section="help">
            <i class="fas fa-question-circle"></i>
            <span>Help</span>
        </div>
        <div class="wm-footer-button" data-section="privacy">
            <i class="fas fa-shield-alt"></i>
            <span>Privacy</span>
        </div>
        <div class="wm-footer-button" data-section="tos">
            <i class="fas fa-file-contract"></i>
            <span>TOS</span>
        </div>
    </div>
    
    <!-- Iframe Container -->
    <div class="wm-iframe-container" id="iframeContainer">
        <div class="wm-iframe-header">
            <div>Offer Wall</div>
            <div class="wm-button" id="closeIframe">Close</div>
        </div>
        <div class="wm-iframe-content">
            <iframe id="dashboardIframe" src=""></iframe>
        </div>
    </div>
    
    <!-- Game Modal -->
    <div class="modal-overlay" id="gameModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Bux iQ Game</h2>
                <button class="modal-close" id="closeGameModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="game-container">
                    <h3 class="game-title">Swipe Roller Game</h3>
                    <p class="game-description">Place your bet and swipe the roller to test your luck!</p>
                    
                    <div class="bet-input-container">
                        <input type="number" class="bet-input" id="betAmount" min="0.25" step="0.25" value="0.25" placeholder="Enter bet amount">
                        <div class="bet-info">Minimum bet: $0.25</div>
                    </div>
                    
                    <div class="game-roller" id="gameRoller">
                        <div class="roller-content" id="rollerContent">Swipe to Play</div>
                    </div>
                    
                    <div class="game-result" id="gameResult"></div>
                    
                    <div class="cooldown-message" id="cooldownMessage">
                        <i class="fas fa-clock"></i> You can play again in <span id="cooldownTimer">00:00:00</span>
                    </div>
                    
                    <div class="wm-button primary" id="playGameBtn" style="width: 100%;">Play Game</div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
// Global variables
let captchaCode = '';
let currentUser = null;
const adUnit = 'default_ad_unit'; // Added missing adUnit variable
let gameCooldown = false;
let cooldownInterval = null;

// Google Apps Script URL for posting data to Google Sheets
const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxLwW7NEXLMSDPh1A_PJbTjAucIuji6JtsgVu2xAdaMzXthTKsgk2xyWy83Dx8dO53Rrg/exec';

// DOM Content Loaded - Initialize everything
document.addEventListener('DOMContentLoaded', function() {
    // Generate initial CAPTCHA
    generateCaptcha();

    // Check for existing session
    checkExistingSession();

    // Initialize all event listeners
    initializeEventListeners();

    // Start server time updates
    updateServerTime();
    setInterval(updateServerTime, 1000);
    
    // Update header time
    updateHeaderTime();
    setInterval(updateHeaderTime, 60000);
    
    // Load activity logs
    fetchCSV();
    
    // Load leaderboard();
    
    // Check game cooldown
    checkGameCooldown();
});

// Initialize all event listeners
function initializeEventListeners() {
    // Tab click handlers
    document.querySelectorAll('.wm-tab').forEach(tab => {
        tab.addEventListener('click', e => {
            e.preventDefault();
            showSection(tab.dataset.section);
            
            // Update active tab
            document.querySelectorAll('.wm-tab').forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
        });
    });

    // Footer navigation handlers
    document.querySelectorAll('.wm-footer-button').forEach(button => {
        button.addEventListener('click', e => {
            e.preventDefault();
            showSection(button.dataset.section);
            
            // Update active footer button
            document.querySelectorAll('.wm-footer-button').forEach(b => b.classList.remove('active'));
            button.classList.add('active');
        });
    });

    // Login button
    document.getElementById('loginButton')?.addEventListener('click', () => {
        showSection('profile');
        document.querySelectorAll('.wm-tab').forEach(t => t.classList.remove('active'));
        document.querySelector('.wm-tab[data-section="profile"]').classList.add('active');
        document.querySelectorAll('.wm-footer-button').forEach(b => b.classList.remove('active'));
        document.querySelector('.wm-footer-button[data-section="profile"]').classList.add('active');
    });

    // Login form handler
    document.getElementById('loginFormButton')?.addEventListener('click', handleLogin);

    // Iframe close button
    document.getElementById('closeIframe')?.addEventListener('click', closeIframe);

    // Logout button
    document.getElementById('logoutBtn')?.addEventListener('click', logout);

    // Contact support button
    document.getElementById('contact-support-btn')?.addEventListener('click', () => {
        alert('Please email support@buxiq.com for assistance.');
    });

    // Bonus redeem button
    document.getElementById('redeemBonusButton')?.addEventListener('click', redeemBonusCode);

    // Initialize offerwall buttons
    initializeOfferwallButtons();
    
    // Game related event listeners
    document.getElementById('playGameButton')?.addEventListener('click', openGameModal);
    document.getElementById('closeGameModal')?.addEventListener('click', closeGameModal);
    document.getElementById('playGameBtn')?.addEventListener('click', playGame);
    
    // Game roller swipe functionality
    const gameRoller = document.getElementById('gameRoller');
    if (gameRoller) {
        gameRoller.addEventListener('touchstart', handleTouchStart, false);
        gameRoller.addEventListener('touchmove', handleTouchMove, false);
        gameRoller.addEventListener('touchend', handleTouchEnd, false);
        
        gameRoller.addEventListener('mousedown', handleMouseDown, false);
        gameRoller.addEventListener('mousemove', handleMouseMove, false);
        gameRoller.addEventListener('mouseup', handleMouseUp, false);
        gameRoller.addEventListener('mouseleave', handleMouseUp, false);
    }
}

// Touch event variables
let xDown = null;
let yDown = null;
let isSwiping = false;

function handleTouchStart(evt) {
    if (gameCooldown) return;
    
    const firstTouch = evt.touches[0];
    xDown = firstTouch.clientX;
    yDown = firstTouch.clientY;
    isSwiping = true;
}

function handleTouchMove(evt) {
    if (!xDown || !yDown || !isSwiping) return;
    
    const xUp = evt.touches[0].clientX;
    const yUp = evt.touches[0].clientY;
    
    const xDiff = xDown - xUp;
    const yDiff = yDown - yUp;
    
    // Check if it's a horizontal swipe
    if (Math.abs(xDiff) > Math.abs(yDiff)) {
        if (xDiff > 0) {
            // Left swipe
            document.getElementById('rollerContent').textContent = "Swiping...";
        } else {
            // Right swipe
            document.getElementById('rollerContent').textContent = "Swiping...";
        }
    }
}

function handleTouchEnd(evt) {
    if (!isSwiping) return;
    
    isSwiping = false;
    
    // Check if it's a valid swipe (minimum distance)
    if (xDown && yDown) {
        const xUp = evt.changedTouches[0].clientX;
        const yUp = evt.changedTouches[0].clientY;
        
        const xDiff = xDown - xUp;
        const yDiff = yDown - yUp;
        
        // Check if it's a horizontal swipe with minimum distance
        if (Math.abs(xDiff) > 50 && Math.abs(xDiff) > Math.abs(yDiff)) {
            playGame();
        } else {
            document.getElementById('rollerContent').textContent = "Swipe to Play";
        }
    }
    
    xDown = null;
    yDown = null;
}

// Mouse event handlers for desktop
function handleMouseDown(evt) {
    if (gameCooldown) return;
    
    xDown = evt.clientX;
    yDown = evt.clientY;
    isSwiping = true;
}

function handleMouseMove(evt) {
    if (!xDown || !yDown || !isSwiping) return;
    
    const xUp = evt.clientX;
    const yUp = evt.clientY;
    
    const xDiff = xDown - xUp;
    const yDiff = yDown - yUp;
    
    // Check if it's a horizontal swipe
    if (Math.abs(xDiff) > Math.abs(yDiff)) {
        document.getElementById('rollerContent').textContent = "Swiping...";
    }
}

function handleMouseUp(evt) {
    if (!isSwiping) return;
    
    isSwiping = false;
    
    // Check if it's a valid swipe (minimum distance)
    if (xDown && yDown) {
        const xUp = evt.clientX;
        const yUp = evt.clientY;
        
        const xDiff = xDown - xUp;
        const yDiff = yDown - yUp;
        
        // Check if it's a horizontal swipe with minimum distance
        if (Math.abs(xDiff) > 50 && Math.abs(xDiff) > Math.abs(yDiff)) {
            playGame();
        } else {
            document.getElementById('rollerContent').textContent = "Swipe to Play";
        }
    }
    
    xDown = null;
    yDown = null;
}

// Game functions
function openGameModal() {
    if (!currentUser) {
        alert('Please login first to play the game.');
        showSection('profile');
        return;
    }
    
    document.getElementById('gameModal').style.display = 'flex';
    checkGameCooldown();
}

function closeGameModal() {
    document.getElementById('gameModal').style.display = 'none';
    document.getElementById('gameResult').style.display = 'none';
    document.getElementById('rollerContent').textContent = "Swipe to Play";
}

function playGame() {
    if (gameCooldown) {
        alert('Please wait for the cooldown to finish before playing again.');
        return;
    }
    
    const betAmount = parseFloat(document.getElementById('betAmount').value);
    const userBalance = parseFloat(currentUser[3] || 0);
    
    // Validate bet amount
    if (isNaN(betAmount) || betAmount < 0.25) {
        alert('Minimum bet is $0.25');
        return;
    }
    
    if (betAmount > userBalance) {
        alert('Insufficient balance');
        return;
    }
    
    // Disable play button during animation
    document.getElementById('playGameBtn').disabled = true;
    
    // Show rolling animation
    const rollerContent = document.getElementById('rollerContent');
    rollerContent.textContent = "Rolling...";
    
    // Simulate rolling animation
    let rollCount = 0;
    const rollInterval = setInterval(() => {
        rollCount++;
        if (rollCount % 2 === 0) {
            rollerContent.textContent = "Rolling...";
        } else {
            rollerContent.textContent = "Rolling..";
        }
        
        if (rollCount >= 10) {
            clearInterval(rollInterval);
            determineGameResult(betAmount);
        }
    }, 100);
}

function determineGameResult(betAmount) {
    // 50% chance to win
    const win = Math.random() > 0.5;
    const multiplier = win ? 2 : 0;
    const payout = win ? betAmount * multiplier : 0;
    const netChange = payout - betAmount;
    
    // Update UI with result
    const gameResult = document.getElementById('gameResult');
    gameResult.textContent = win ? 
        `Congratulations! You won $${payout.toFixed(2)}!` : 
        `Sorry! You lost $${betAmount.toFixed(2)}.`;
    
    gameResult.className = win ? 'game-result win' : 'game-result lose';
    gameResult.style.display = 'block';
    
    // Update roller content
    document.getElementById('rollerContent').textContent = win ? "WINNER!" : "TRY AGAIN";
    
    // Re-enable play button
    document.getElementById('playGameBtn').disabled = false;
    
    // Send postback
    sendGamePostback(win, betAmount, payout, netChange);
    
    // Set cooldown
    setGameCooldown();
}

function sendGamePostback(win, betAmount, payout, netChange) {
    const timestamp = Date.now();
    const status = win ? 'win' : 'lose';
    const userId = currentUser[4] || currentUser[0] || 'user';
    const userIp = '192.168.1.1'; // In a real app, you would get this from the server
    const countryCode = 'US'; // In a real app, you would get this from the server
    const secret = 'secure_hash_value'; // In a real app, you would use a proper hash
    
    const postbackUrl = `https://script.google.com/macros/s/AKfycbyvw4LiShTvgnTTLRLISnTYJRhqeStmZgL9YD_ZuQEJubcDPH8bSbGpHPCVHDfx0dbW/exec?status=${status}&trans_id=${timestamp}&user_id=${userId}&amount_local=${netChange}&amount_usd=${payout}&offer_id=game&hash=${secret}&ip_click=${userIp}&country=${countryCode}`;
    
    fetch(postbackUrl)
        .then(response => response.json())
        .then(data => {
            console.log('Game postback success:', data);
            // Update balance after successful postback
            updateBalance();
            addToLogs(`Game: ${win ? 'Won' : 'Lost'} $${Math.abs(netChange).toFixed(2)}`);
        })
        .catch(error => {
            console.error('Game postback error:', error);
            alert('Error processing game result. Please try again.');
        });
}

function setGameCooldown() {
    const cooldownTime = 60 * 60 * 1000; // 1 hour in milliseconds
    const cooldownEnd = Date.now() + cooldownTime;
    
    localStorage.setItem('buxiq_game_cooldown', cooldownEnd.toString());
    gameCooldown = true;
    
    // Update UI
    document.getElementById('cooldownMessage').style.display = 'block';
    
    // Start countdown
    if (cooldownInterval) clearInterval(cooldownInterval);
    cooldownInterval = setInterval(updateCooldownTimer, 1000);
    updateCooldownTimer();
}

function checkGameCooldown() {
    const cooldownEnd = localStorage.getItem('buxiq_game_cooldown');
    
    if (cooldownEnd && Date.now() < parseInt(cooldownEnd)) {
        gameCooldown = true;
        document.getElementById('cooldownMessage').style.display = 'block';
        
        // Start countdown
        if (cooldownInterval) clearInterval(cooldownInterval);
        cooldownInterval = setInterval(updateCooldownTimer, 1000);
        updateCooldownTimer();
    } else {
        gameCooldown = false;
        document.getElementById('cooldownMessage').style.display = 'none';
        if (cooldownInterval) clearInterval(cooldownInterval);
    }
}

function updateCooldownTimer() {
    const cooldownEnd = localStorage.getItem('buxiq_game_cooldown');
    
    if (!cooldownEnd) {
        gameCooldown = false;
        document.getElementById('cooldownMessage').style.display = 'none';
        if (cooldownInterval) clearInterval(cooldownInterval);
        return;
    }
    
    const remaining = parseInt(cooldownEnd) - Date.now();
    
    if (remaining <= 0) {
        gameCooldown = false;
        document.getElementById('cooldownMessage').style.display = 'none';
        if (cooldownInterval) clearInterval(cooldownInterval);
        localStorage.removeItem('buxiq_game_cooldown');
        return;
    }
    
    const hours = Math.floor(remaining / (1000 * 60 * 60));
    const minutes = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((remaining % (1000 * 60)) / 1000);
    
    document.getElementById('cooldownTimer').textContent = 
        `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
}

// Rest of the existing code remains the same...
// Initialize offerwall buttons with user validation
function initializeOfferwallButtons() {
    Object.keys(offerwallButtons).forEach(buttonId => {
        const button = document.getElementById(buttonId);
        if (button) {
            // Remove any existing listeners to prevent duplicates
            button.removeEventListener('click', offerwallClickHandler);
            // Add new listener
            button.addEventListener('click', offerwallClickHandler);
        }
    });
}

// Handler for offerwall button clicks
function offerwallClickHandler(e) {
    e.preventDefault();

    if (!currentUser) {
        alert('Please login first to access offerwalls');
        showSection('profile');
        return;
    }

    const buttonId = this.id;
    const urlGenerator = offerwallButtons[buttonId];

    if (!urlGenerator) {
        console.error('No URL generator found for button:', buttonId);
        return;
    }

    // Use user[4] (username) or user[0] (account) as fallback
    const username = currentUser[4] || currentUser[0] || 'user';
    const url = typeof urlGenerator === 'function' ? urlGenerator(username) : urlGenerator;

    console.log(`Opening offerwall ${buttonId} for user ${username}`);
    openIframe(url);
}

// Enhanced iframe functions
function openIframe(url) {
    const iframeContainer = document.getElementById('iframeContainer');
    const dashboardIframe = document.getElementById('dashboardIframe');

    if (!iframeContainer || !dashboardIframe) {
        console.error('Iframe elements not found');
        return;
    }

    dashboardIframe.src = url;
    iframeContainer.style.display = 'block';
}

function closeIframe() {
    const iframeContainer = document.getElementById('iframeContainer');
    const dashboardIframe = document.getElementById('dashboardIframe');

    if (iframeContainer && dashboardIframe) {
        iframeContainer.style.display = 'none';
        dashboardIframe.src = '';
    }
}

// Update server time display
function updateServerTime() {
    const now = new Date();

    // Convert to PST (UTC-8) or PDT (UTC-7) depending on daylight saving
    const pstOffset = now.getTimezoneOffset() >= 480 ? -8 * 60 : -7 * 60; // PST is UTC-8, PDT is UTC-7
    const pstTime = new Date(now.getTime() + (now.getTimezoneOffset() - pstOffset) * 60000);

    // Format as HH:MM:SS
    const hours = String(pstTime.getHours()).padStart(2, '0');
    const minutes = String(pstTime.getMinutes()).padStart(2, '0');
    const seconds = String(pstTime.getSeconds()).padStart(2, '0');

    document.getElementById('serverTime').textContent = `Server Time: ${hours}:${minutes}:${seconds} PST`;
}

// Update header time
function updateHeaderTime() {
    const now = new Date();
    const hours = now.getHours();
    const minutes = String(now.getMinutes()).padStart(2, '0');
    const ampm = hours >= 12 ? 'PM' : 'AM';
    const displayHours = hours % 12 || 12;
    
    document.getElementById('headerTime').textContent = `${displayHours}:${minutes} ${ampm}`;
}

// Object with offerwall URLs and open functions
const offerwallButtons = {
    'openOfferWallCPX': (user) => `https://offers.cpx-research.com/index.php?app_id=26219&ext_user_id=${user}&username=${user}&subid_1=&subid_2`,
    'openOfferWallexcentiv': (user) => `https://excentiv.com/offerwall/?userid=${user}&key=q1v8KGQfCjmNeXnhsHyo`,
    'openOfferWallwannads': (user) => `https://earn.wannads.com/surveywall?apiKey=67d3d43d63631681386947&userId=${user}`,
    'openOfferWallmc': (user) => `https://sdk.mychips.io/content?content_id=16cbcd08-387a-498f-b4bd-9f4d2c6883a7&user_id=${user}&ad_unit_id=${adUnit}`,
    'openOfferWallSPARKWALL': (user) => `https://spark-wall.com/offerwall/G2kA8XaPF2jjstApSCZsK6aE6qudMN/${user}&username=${user}&subid_1=&subid_2`,
    'openOfferWallowm': (user) => `https://offerwallmedia.com/offerwall/vfox4w1tpz3gflta3gblkkqp8b2aoj/${user}`,
    'openOfferWallnotik': (user) => `https://notik.me/coins?api_key=eQpYGMydTs5GP0DfFPQrJotOwKo6V0Hy&pub_id=LJ2g&app_id=GxEBh1Hn3m&user_id=${user}`,
    'openOfferWallbuxiq': () => `https://bux-iq.netlify.app/cashout.html`
};

// Check for existing user session
function checkExistingSession() {
    const savedAccount = localStorage.getItem('buxiq_account');
    const savedGoogleUser = localStorage.getItem('buxiq_google_user');
    
    if (savedGoogleUser) {
        // Handle Google user session restoration with blocked check
        checkAndRestoreGoogleSession(savedGoogleUser);
    } else if (savedAccount) {
        // Handle manual login session restoration
        restoreManualSession(savedAccount);
    } else {
        // Show default section if no session
        showSection('earn');
    }
}

// Check and restore Google session with blocked validation
async function checkAndRestoreGoogleSession(savedGoogleUser) {
    try {
        const googleUser = JSON.parse(savedGoogleUser);
        
        // Check if user still exists and is not blocked
        const response = await fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vQHuo-I6k4RbAnXvz_FvCzshqg7Cm5dqAXwNkvDLpgpZH84OGUSbX6TiOUfMrCHv3CiNnLnx0IhzNZC/pub?gid=0&single=true&output=csv');
        if (!response.ok) throw new Error('Network response was not ok');

        const data = await response.text();
        const rows = data.trim().split('\n').map(row => row.split(','));

        // Find user by Google ID or email
        const user = rows.find(r => r[7] === googleUser.id || r[8] === googleUser.email);

        if (user) {
            // Check if user is blocked
            const status = (user[2] || '').toLowerCase();
            if (status === 'blocked') {
                // Clear blocked user session
                localStorage.removeItem('buxiq_google_user');
                showSection('earn');
                return;
            }
            
            // User is valid, restore session
            simulateGoogleLoginRestore(googleUser);
        } else {
            // User not found in database, clear session
            localStorage.removeItem('buxiq_google_user');
        }
    } catch (err) {
        console.error('Error checking Google session:', err);
        // On error, clear session to be safe
        localStorage.removeItem('buxiq_google_user');
    }
}

// Restore manual session
async function restoreManualSession(account) {
    try {
        const response = await fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vQHuo-I6k4RbAnXvz_FvCzshqg7Cm5dqAXwNkvDLpgpZH84OGUSbX6TiOUfMrCHv3CiNnLnx0IhzNZC/pub?gid=0&single=true&output=csv');
        if (!response.ok) throw new Error('Network response was not ok');

        const data = await response.text();
        const rows = data.trim().split('\n').map(row => row.split(','));

        // Find user by account number
        const user = rows.find(r => r[0] === account);

        if (user) {
            // Check if user is blocked
            const status = (user[2] || '').toLowerCase();
            if (status === 'blocked') {
                // Clear blocked user session
                localStorage.removeItem('buxiq_account');
                return;
            }
            
            currentUser = user;
            updateUserUI(user);
            
            // Show dashboard
            document.getElementById('login-container').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
            
            // Update balance
            await updateBalance();
            
            addToLogs(`Session restored for ${user[4] || 'User'}`);
        } else {
            // Clear invalid session
            localStorage.removeItem('buxiq_account');
        }
    } catch (err) {
        console.error('Error restoring session:', err);
    }
}

// Simulate Google login restore
function simulateGoogleLoginRestore(googleUser) {
    const simulatedUser = {
        email: googleUser.email,
        name: googleUser.name,
        id: googleUser.id,
        picture: googleUser.picture
    };
    processGoogleLogin(simulatedUser);
}

// Handle Google Sign-In response
function handleGoogleCredentialResponse(response) {
    console.log("Google Sign-In response:", response);
    
    // Decode the JWT token to get user info
    const responsePayload = parseJwt(response.credential);
    
    console.log("Google user info:", responsePayload);
    
    // Process Google login with the user info
    processGoogleLogin({
        id: responsePayload.sub,
        email: responsePayload.email,
        name: responsePayload.name,
        picture: responsePayload.picture
    });
}

// Parse JWT token
function parseJwt(token) {
    try {
        const base64Url = token.split('.')[1];
        const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
        const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
            return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
        }).join(''));
        
        return JSON.parse(jsonPayload);
    } catch (e) {
        console.error("Error parsing JWT:", e);
        return null;
    }
}

// Process Google Login
async function processGoogleLogin(googleUser) {
    const errorMsg = document.getElementById('error-msg');
    
    try {
        // Check if user exists in Google Sheets
        const response = await fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vQHuo-I6k4RbAnXvz_FvCzshqg7Cm5dqAXwNkvDLpgpZH84OGUSbX6TiOUfMrCHv3CiNnLnx0IhzNZC/pub?gid=0&single=true&output=csv');
        if (!response.ok) throw new Error('Network response was not ok');

        const data = await response.text();
        const rows = data.trim().split('\n').map(row => row.split(','));

        // Look for user by Google ID or email
        const user = rows.find(r => r[7] === googleUser.id || r[8] === googleUser.email);

        if (user) {
            // Check if user is blocked
            const status = (user[2] || '').toLowerCase();
            if (status === 'blocked') {
                showError(errorMsg, 'Your account is blocked.');
                // Clear any stored Google session data
                localStorage.removeItem('buxiq_google_user');
                return;
            }

            // Existing user - login
            currentUser = user;
            await completeLogin(user);
            
            // Store session for Google user
            localStorage.setItem('buxiq_google_user', JSON.stringify({
                id: googleUser.id,
                email: googleUser.email,
                name: googleUser.name,
                picture: googleUser.picture
            }));
        } else {
            // New user - auto-register
            await registerGoogleUser(googleUser);
        }
    } catch (err) {
        console.error('Google login processing error:', err);
        showError(errorMsg, 'Error during Google login. Please try again.');
    }
}

// Register new Google user
async function registerGoogleUser(googleUser) {
    // Generate unique account number and client ID
    const accountNumber = 'G' + Math.random().toString(36).substr(2, 8).toUpperCase();
    const clientId = 'GC' + Math.random().toString(36).substr(2, 6).toUpperCase();
    
    // Create new user data
    const newUser = [
        accountNumber,      // 0: Account #
        clientId,          // 1: Client ID
        'active',          // 2: Status
        '0.00',           // 3: Balance
        googleUser.name,   // 4: Username
        googleUser.picture, // 5: Avatar URL (Google profile picture)
        '1',              // 6: Level
        googleUser.id,    // 7: Google ID
        googleUser.email  // 8: Google Email
    ];
    
    // Post new user to Google Sheets
    await postUserToSheets(newUser);
    
    // In a real implementation, you would send this to your backend/Google Apps Script
    // For now, we'll use the new user data directly
    currentUser = newUser;
    
    // Store in localStorage
    localStorage.setItem('buxiq_google_user', JSON.stringify({
        id: googleUser.id,
        email: googleUser.email,
        name: googleUser.name,
        picture: googleUser.picture,
        account: accountNumber,
        clientId: clientId
    }));
    
    await completeLogin(newUser);
    
    // Show welcome message for new users
    addToLogs(`Welcome ${googleUser.name}! Your account has been created.`);
}

// Post user data to Google Sheets
async function postUserToSheets(userData) {
    try {
        // Prepare data for Google Sheets
        const formData = new FormData();
        formData.append('action', 'addUser');
        formData.append('account', userData[0]);
        formData.append('clientId', userData[1]);
        formData.append('status', userData[2]);
        formData.append('balance', userData[3]);
        formData.append('username', userData[4]);
        formData.append('avatar', userData[5]);
        formData.append('level', userData[6]);
        formData.append('googleId', userData[7]);
        formData.append('googleEmail', userData[8]);
        
        // Send POST request to Google Apps Script
        const response = await fetch(GOOGLE_SCRIPT_URL, {
            method: 'POST',
            body: formData
        });
        
        if (response.ok) {
            console.log('User data successfully posted to Google Sheets');
            return true;
        } else {
            console.error('Failed to post user data to Google Sheets');
            return false;
        }
    } catch (error) {
        console.error('Error posting user data to Google Sheets:', error);
        return false;
    }
}

// Login handler
async function handleLogin(e) {
    e.preventDefault();

    const account = document.getElementById('login-account')?.value?.trim() || '';
    const clientid = document.getElementById('login-clientid')?.value?.trim() || '';
    const captchaInput = document.getElementById('captchaInput')?.value?.trim() || '';
    const errorMsg = document.getElementById('error-msg');

    // For auto-login, allow a temporary bypass for CAPTCHA verification
    const isAutoLogin = e.type === 'auto';
    if (!isAutoLogin && captchaInput !== captchaCode) {
        showError(errorMsg, 'Invalid CAPTCHA');
        generateCaptcha();
        document.getElementById('captchaInput').value = '';
        return;
    }

    try {
        const response = await fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vQHuo-I6k4RbAnXvz_FvCzshqg7Cm5dqAXwNkvDLpgpZH84OGUSbX6TiOUfMrCHv3CiNnLnx0IhzNZC/pub?gid=0&single=true&output=csv');
        if (!response.ok) throw new Error('Network response was not ok');

        const data = await response.text();
        const rows = data.trim().split('\n').map(row => row.split(','));

        // Find user in spreadsheet data based on account and clientid (if not auto-login)
        const user = rows.find(r => r[0] === account && (isAutoLogin || r[1] === clientid));

        if (user) {
            const status = (user[2] || '').toLowerCase();
            if (status === 'blocked') {
                showError(errorMsg, 'Your account is blocked.');
                // Clear login fields and generate new CAPTCHA on blocked account
                document.getElementById('login-account').value = '';
                document.getElementById('login-clientid').value = '';
                document.getElementById('captchaInput').value = '';
                generateCaptcha();
                return;
            }

            // Store current user globally
            currentUser = user;

            // Store in local storage
            localStorage.setItem('buxiq_account', account);

            // Update UI with user data
            updateUserUI(user);

            // Show dashboard
            document.getElementById('login-container')?.classList.add('hidden');
            document.getElementById('dashboard')?.classList.remove('hidden');
            if (errorMsg) errorMsg.classList.add('hidden');

            // Initialize offerwalls for this user
            initializeOfferwallButtons();

            // Load additional data
            fetchCSV(); // For activity logs
            updateBalance(); // Update balance immediately after login
            
            addToLogs(`Login successful for ${user[4] || 'User'}`);
        } else {
            showError(errorMsg, 'Invalid credentials');
            // Clear CAPTCHA input and generate new CAPTCHA on invalid credentials
            document.getElementById('captchaInput').value = '';
            generateCaptcha();
        }
    } catch (err) {
        console.error('Login error:', err);
        showError(errorMsg, 'Error loading data. Please try again.');
        // Clear CAPTCHA input and generate new CAPTCHA on error
        document.getElementById('captchaInput').value = '';
        generateCaptcha();
    } finally {
        // Ensure captchaInput is cleared if it was a temporary auto-login value
        if (isAutoLogin && document.getElementById('captchaInput').value === 'auto_login_temp') {
            document.getElementById('captchaInput').value = '';
        }
    }
}

// Complete login process for both manual and Google login
async function completeLogin(user) {
    // Update user data
    const avatarUrl = user[5] || `https://ui-avatars.com/api/?name=${encodeURIComponent(user[4] || 'User')}&background=e94560&color=fff`;
    
    // Update UI
    document.getElementById('userAvatar').src = avatarUrl;
    document.getElementById('userName').textContent = user[4] || 'User';
    
    // Show dashboard
    document.getElementById('login-container').classList.add('hidden');
    document.getElementById('dashboard').classList.remove('hidden');
    document.getElementById('error-msg').classList.add('hidden');
    
    // Update balance and level
    await updateBalance();
    
    // Add login success message
    addToLogs(`Login successful for ${user[4] || 'User'}`);
}

// Helper function to show errors
function showError(element, message) {
    if (element) {
        element.textContent = message;
        element.classList.remove('hidden');
    } else {
        alert(message);
    }
}

// Update user UI after login
function updateUserUI(user) {
    try {
        const avatarUrl = user[5] || `https://ui-avatars.com/api/?name=${encodeURIComponent(user[4] || 'User')}&background=e94560&color=fff`;

        // Update avatar
        const userAvatar = document.getElementById('userAvatar');
        if (userAvatar) userAvatar.src = avatarUrl;

        // Update username
        const usernameEl = document.getElementById('userName');
        if (usernameEl) usernameEl.textContent = user[4] || 'User';

        // Update level
        const levelEl = document.getElementById('userLevel');
        if (levelEl) levelEl.textContent = user[6] || '1';

        // Update balance
        updateBalance();
    } catch (error) {
        console.error('Error updating user UI:', error);
    }
}

// Logout function
function logout() {
    try {
        if (currentUser) {
            // If it's a Google user, remove Google data too
            if (currentUser[7]) { // Google ID exists
                localStorage.removeItem('buxiq_google_user');
            }
        }

        currentUser = null;
        localStorage.removeItem('buxiq_account');

        document.getElementById('dashboard')?.classList.add('hidden');
        document.getElementById('login-container')?.classList.remove('hidden');
        document.getElementById('login-account').value = '';
        document.getElementById('login-clientid').value = '';
        document.getElementById('captchaInput').value = '';

        const errorMsg = document.getElementById('error-msg');
        if (errorMsg) errorMsg.classList.add('hidden');

        generateCaptcha();
        showSection('earn'); // Return to default 'earn' section on logout

        // Reset user info display
        const userAvatar = document.getElementById('userAvatar');
        const usernameEl = document.getElementById('userName');
        const levelEl = document.getElementById('userLevel');
        const balanceEl = document.getElementById('userBalance');
        
        if (userAvatar) userAvatar.src = 'https://ui-avatars.com/api/?background=e94560&color=fff&name=Guest&bold=true';
        if (usernameEl) usernameEl.textContent = 'Guest User';
        if (levelEl) levelEl.textContent = '0';
        if (balanceEl) balanceEl.textContent = '$0.00';
        
        addToLogs('You have been logged out.');
    } catch (error) {
        console.error('Error during logout:', error);
    }
}

// Generate CAPTCHA
function generateCaptcha() {
    try {
        captchaCode = Math.floor(10000 + Math.random() * 90000).toString();
        const captchaEl = document.getElementById('captcha');
        if (captchaEl) {
            captchaEl.textContent = captchaCode;
        }
        return captchaCode;
    } catch (error) {
        console.error('Error generating CAPTCHA:', error);
        return '12345'; // Fallback CAPTCHA
    }
}

// Navigation handler
function showSection(section) {
    try {
        const sections = ['earn', 'shop', 'leaders', 'profile', 'bonus', 'help', 'privacy', 'tos'];
        sections.forEach(sec => {
            const sectionEl = document.getElementById('section-' + sec);
            if (sectionEl) {
                sectionEl.classList.toggle('hidden', sec !== section);
            }
        });
    } catch (error) {
        console.error('Error showing section:', error);
    }
}

// Update balance function (can be called separately to refresh)
async function updateBalance() {
    try {
        if (!currentUser) {
            console.warn('Cannot update balance: no current user.');
            return;
        }

        const response = await fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vQHuo-I6k4RbAnXvz_FvCzshqg7Cm5dqAXwNkvDLpgpZH84OGUSbX6TiOUfMrCHv3CiNnLnx0IhzNZC/pub?gid=0&single=true&output=csv');
        if (!response.ok) throw new Error('Network error');

        const data = await response.text();
        const rows = data.trim().split('\n').map(r => r.split(','));
        // Find user by account and clientid for accuracy
        const user = rows.find(r => r[0] === currentUser[0] && r[1] === currentUser[1]);

        const balanceEl = document.getElementById('userBalance');
        const levelEl = document.getElementById('userLevel');

        if (user) {
            // Fix NaN issue by ensuring we have a valid number
            const balance = parseFloat(user[3] || '0');
            if (!isNaN(balance)) {
                if (balanceEl) balanceEl.textContent = `$${balance.toFixed(2)}`;
            } else {
                if (balanceEl) balanceEl.textContent = '$0.00';
            }
            
            // Update level
            if (levelEl) levelEl.textContent = user[6] || '1';
            
            // Update currentUser with latest data
            currentUser = user;
        } else {
            // If user not found (e.g., after logout), reset balance display to 0
            if (balanceEl) balanceEl.textContent = '$0.00';
            if (levelEl) levelEl.textContent = '0';
        }
    } catch (err) {
        console.error('Error updating balance:', err);
    }
}

// Fetch CSV for activity logs
async function fetchCSV() {
    try {
        const response = await fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vQ3p3daAnCETfJtrUUvaiNqoUreYkn9FIHus6rEyq-e8E8oLaV51L_NrVWjHp1CyTv3UqBqryq3aH-0/pub?gid=0&single=true&output=csv');
        if (!response.ok) throw new Error('Network error');

        const data = await response.text();
        const rows = data.trim().split('\n').slice(1); // skip header
        const logsContainer = document.getElementById('logs');

        if (!logsContainer) return;
        
        // Clear existing logs except the initial message
        const initialMessage = logsContainer.querySelector('.wm-list-item');
        logsContainer.innerHTML = '';
        if (initialMessage && rows.length === 0) {
            logsContainer.appendChild(initialMessage);
        }

        let hasLogs = false;
        rows.forEach((row, index) => {
            const cols = row.split(',').map(c => c.trim());
            // Ensure necessary columns exist and are not empty
            if (cols.length >= 7 && cols[2] && cols[6]) {
                hasLogs = true;
                const username = cols[2];
                const amount = parseFloat(cols[6]).toFixed(2); // Format amount to 2 decimal places
                const logDiv = document.createElement('div');
                logDiv.className = 'wm-list-item';
                logDiv.innerHTML = `
                    <div class="icon"><i class="fas fa-user"></i></div>
                    <div>${username} earned $${amount}</div>
                `;
                logsContainer.appendChild(logDiv);
            }
        });

        if (!hasLogs && initialMessage) {
            // Keep the initial message if no logs
        }
    } catch (err) {
        console.error('Error fetching activity logs:', err);
        const logsContainer = document.getElementById('logs');
        if (logsContainer) {
            logsContainer.innerHTML = '<div class="wm-list-item"><div class="icon"><i class="fas fa-exclamation-triangle"></i></div><div>Error loading activity logs.</div></div>';
        }
    }
}

// Load leaderboard from CSV
async function loadLeaderboard() {
    try {
        const response = await fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vQHuo-I6k4RbAnXvz_FvCzshqg7Cm5dqAXwNkvDLpgpZH84OGUSbX6TiOUfMrCHv3CiNnLnx0IhzNZC/pub?gid=0&single=true&output=csv');
        if (!response.ok) throw new Error('Network error');

        const data = await response.text();
        const rows = data.trim().split('\n').slice(1); // skip header
        
        // Sort users by balance (descending)
        const users = rows.map(row => {
            const cols = row.split(',');
            return {
                username: cols[4] || 'Unknown',
                balance: parseFloat(cols[3] || 0),
                level: cols[6] || '1'
            };
        }).sort((a, b) => b.balance - a.balance).slice(0, 10); // Top 10 users
        
        const leaderboardBody = document.getElementById('leaderboardBody');
        if (!leaderboardBody) return;
        
        leaderboardBody.innerHTML = '';
        
        users.forEach((user, index) => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${index + 1}</td>
                <td>${user.username}</td>
                <td>$${user.balance.toFixed(2)}</td>
                <td>${user.level}</td>
            `;
            leaderboardBody.appendChild(row);
        });
    } catch (err) {
        console.error('Error loading leaderboard:', err);
    }
}

// Helper function to add messages to logs
function addToLogs(message) {
    const logsContainer = document.getElementById('logs');
    const logEntry = document.createElement('div');
    logEntry.className = 'wm-list-item';
    logEntry.innerHTML = `
        <div class="icon"><i class="fas fa-info-circle"></i></div>
        <div>${new Date().toLocaleTimeString()} - ${message}</div>
    `;
    
    // Remove initial placeholder if it exists
    const initialMessage = logsContainer.querySelector('.wm-list-item:first-child');
    if (initialMessage && initialMessage.textContent.includes('activity log will appear here')) {
        logsContainer.removeChild(initialMessage);
    }
    
    logsContainer.appendChild(logEntry);
    logsContainer.scrollTop = logsContainer.scrollHeight;
}

// Bonus Code Redemption
async function redeemBonusCode() {
    const username = document.getElementById('username')?.value?.trim();
    const bonusCode = document.getElementById('bonusCode')?.value?.trim();
    
    if (!username || !bonusCode) {
        alert('Please fill in all fields');
        return;
    }
    
    try {
        // Send a request to the Google Apps Script web app to fetch data from the Google Sheets
        const response = await fetch(`https://script.google.com/macros/s/AKfycbxmqOnPJLPuHD6u_DD66bwY0R4MYQ8v9uF1Mv0pm8Sg9APSS4R4oXzbs3zin2FoTMK5/exec?username=${username}&bonusCode=${bonusCode}`);
        const result = await response.text();

        console.log('Bonus redemption result:', result); // For debugging

        if (result.includes("Error")) {
            alert(result);
        } else {
            const [amountLocal, amountUsd] = result.split(','); // Expecting data in format "amountLocal,amountUsd"
            document.getElementById('amountLocal').value = amountLocal;
            document.getElementById('amountUsd').value = amountUsd;
            sendPostback(amountLocal, amountUsd, username, bonusCode); // Call the postback function
            alert('Bonus code redeemed successfully!');
        }
    } catch (error) {
        console.error('Error redeeming bonus code:', error);
        alert('Error redeeming bonus code. Please try again.');
    }
}

// Postback Function
function sendPostback(amountLocal, amountUsd, username, bonusCode) {
    const timestamp = new Date().getTime();
    const postbackUrl = `https://script.google.com/macros/s/AKfycbyvw4LiShTvgnTTLRLISnTYJRhqeStmZgL9YD_ZuQEJubcDPH8bSbGpHPCVHDfx0dbW/exec?status=success&trans_id=${timestamp}&user_id=${username}&bonusCode=${bonusCode}&sub_id=&sub_id_2=&amount_local=${amountLocal}&amount_usd=${amountUsd}&offer_id=offer001&hash=secure_hash_value&ip_click=192.168.1.1`;

    fetch(postbackUrl)
        .then(response => response.json())
        .then(data => console.log('Postback Success:', data))
        .catch(error => console.error('Postback Error:', error));
}
    </script>
</body>
</html>
